{% set firebaseConfigured = env.firebaseConfig.apiKey %}
{% set recaptchaConfigured = env.recaptchaSiteKey %}
{% set commentsDisabled = (not firebaseConfigured) or (not recaptchaConfigured) %}
<section class="comments" data-comment-section data-post-id="{{ page.url }}">
  <h2 id="comments-title">Community Comments</h2>
  <div class="comments__loading" data-comments-loading role="status" {% if commentsDisabled %}hidden{% endif %}>Loading commentsâ€¦</div>
  <p class="comments__empty" data-comments-empty hidden>No comments have been approved yet. Be the first to share your thoughts.</p>
  <div class="comments__error" data-comments-error hidden role="alert"></div>
  <ol class="comments__list" data-comments-list aria-labelledby="comments-title"></ol>
  <section class="comment-form" aria-labelledby="leave-a-comment">
    <h3 id="leave-a-comment">Leave a comment</h3>
    {% if not firebaseConfigured %}
    <p class="comment-form__notice">Comments are disabled until Firebase credentials are configured.</p>
    {% endif %}
    {% if not env.recaptchaSiteKey %}
    <p class="comment-form__notice">reCAPTCHA is not configured. Comments are disabled until a site key is provided.</p>
    {% endif %}
    <form data-comment-form novalidate>
      <div class="comment-form__row">
        <label for="comment-name">Name</label>
        <input id="comment-name" name="name" type="text" required autocomplete="name">
      </div>
      <div class="comment-form__row">
        <label for="comment-email">Email</label>
        <input id="comment-email" name="email" type="email" required autocomplete="email">
      </div>
      <div class="comment-form__row">
        <label for="comment-message">Comment</label>
        <textarea id="comment-message" name="message" rows="5" required maxlength="1500"></textarea>
      </div>
      <div class="comment-form__row">
        <label class="sr-only" for="comment-post-id">Post ID</label>
        <input id="comment-post-id" name="postId" type="hidden" value="{{ page.url }}">
      </div>
      <div class="comment-form__row">
        <div class="g-recaptcha" data-sitekey="{{ env.recaptchaSiteKey }}"></div>
      </div>
      <div class="comment-form__actions">
        <button type="submit" {% if commentsDisabled %}disabled{% endif %}>Submit Comment</button>
      </div>
      <p class="comment-form__success" data-comment-success hidden>Thank you! Your comment has been submitted for review.</p>
    </form>
  </section>
</section>
